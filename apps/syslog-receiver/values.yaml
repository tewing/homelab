# see https://github.com/fluent/helm-charts/blob/main/charts/fluent-bit/values.yaml
fluent-bit:
  kind: Deployment
  replicaCount: 1

  service:
    enabled: true
    type: LoadBalancer
    annotations: {}
    port: 0
    ports:
      - name: syslog-tcp
        port: 5140
        protocol: TCP
        targetPort: 5140

  config:
    service: |
      [SERVICE]
          Daemon Off
          Flush 1
          Log_Level info
          Parsers_File /fluent-bit/etc/parsers.conf
          Parsers_File /fluent-bit/etc/conf/custom_parsers.conf
          HTTP_Server Off
          HTTP_Listen 0.0.0.0
          HTTP_Port 0
          Health_Check Off

    inputs: |
      [INPUT]
          Name              syslog
          Tag               syslog.*
          Listen            0.0.0.0
          Port              5140
          Mode              tcp
          # Optional: Use a specific parser if needed, e.g., syslog-rfc5424
          Parser            syslog-rfc3164

    filters: |
      # Optional: Add filters here if needed.
      [FILTER]
          Name              stdout
          Match             syslog.*

    outputs: |
      [OUTPUT]
          Name              s3
          Match             syslog.*
          Region            us-east-1
          Bucket            tewing-syslog-test
          # Directory for local buffering
          Store_dir         /tmp/flb-storage/s3
          # Size of files to upload to S3
          Total_file_size   10M
          # Timeout for uploads
          Upload_timeout    5m
          # Optional: Store logs as newline delimited JSON, raw logs, etc.
          # Format            s3_key_format
          # Disable the default date key if you want raw logs
          json_date_key     false
          # Ensure data is uploaded in order
          Preserve_data_ordering On

  rbac:
    create: true
  serviceAccount:
    create: true
    # # Annotate with an IAM role ARN for auth (recommended over static credentials)
    # annotations:
    #   ://eks.amazonaws.com: arn:aws:iam::123456789012:role/your-fluentbit-s3-role

  # Ensure the pod has a writeable volume mounted for buffering
  Deployment:
    volumes:
      - name: fluentbit-storage
        emptyDir: {}
    volumeMounts:
      - name: fluentbit-storage
        mountPath: /tmp/flb-storage

  extraPorts:
    - name: syslog-tcp
      containerPort: 5140
      hostPort: 5140
      protocol: TCP
      port: 5140
